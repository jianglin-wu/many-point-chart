!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.manyPointChart=e()}(this,function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},n=function(){function i(){t(this,i),this.events={}}return e(i,[{key:"on",value:function(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e)}},{key:"emit",value:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];var o=this.events[t];o&&o.forEach(function(t){t.apply(null,i)})}}]),i}();function o(t,e,i){return(t-i)/e}function a(t,e,i,n){if(t.beginPath(),"point"===i){var o=n.x,a=n.y,r=n.radius,s=n.radian;t.moveTo(o,a),t.arc(o,a,r,0,s,!0)}else if("rect"===i){var l=n.x,c=n.y,f=n.w,u=n.h;t.rect(l,c,f,u)}var h=t.isPointInPath(e.offsetX,e.offsetY);return t.closePath(),h}function r(t,e,i){e.x;var n=e.y,o=e.w,a=e.h,r=i.tables,s=i.offsetLeft,l=i.scaleTop,c=i.gridSpacingY,f=.8*s,u=a/r.length;t.textAlign="right",t.font="12px Arial";var h=l-(n+a)>.01*a;return r.forEach(function(e,i){var a=e.title,l=e.fillStyle,v=n+u*i,p=(u+12)/2+v;t.fillStyle=l,t.fillText(a,f,p,f),function(t,e,i){var n=e.x,o=e.y,a=e.w,r=e.h,s=i.topShow,l=i.bottomShow,c=i.gridSpacingY;(s||l)&&(t.setLineDash([]),t.strokeStyle="#000",t.lineWidth=1,t.beginPath(),s&&(t.moveTo(n,o+1),t.lineTo(n+a,o+1)),l&&(t.moveTo(n,o+r-1),t.lineTo(n+a,o+r-1)),t.stroke());var f=parseInt(r/c,10);c+=r%c/f;var u=o;t.beginPath();for(var h=1;h<f;h++)u+=c,t.strokeStyle="#ccc",t.setLineDash([5,2,25,10]),t.moveTo(n,u),t.lineTo(n+a,u);t.stroke()}(t,{x:s,y:v,w:o-s,h:u},{topShow:0===i,gridSpacingY:c,bottomShow:i!==r.length-1||h})}),function(e,i){return r.map(function(o,a){var r=o.keyName,s=o.min,l=o.max,c=o.setPercentage,f=o.lineWidth,h=o.pointRadius,v=o.pointRadian,p=o.fillStyle,d=o.strokeStyle,y=n+u*a,m=l-s;t.setLineDash([]),t.strokeStyle=d,t.fillStyle=p,t.lineWidth=f,t.beginPath();var g=e.map(function(e,n){var o=e.name,a=e.span,l=e.offsetLeft,f=i[n][r],h=function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=c(e,m,s),a=y+u-u*o;return 0===n&&0===i?t.moveTo(l,a):t.lineTo(l,a),{y:a,percentage:o,value:e}};return{name:o,values:f=Array.isArray(f)?f.map(h):"number"==typeof f?h(f):[],x:l,span:a}});return t.stroke(),g.forEach(function(e){var i=e.values,n=e.x;i.forEach(function(e){var i=e.y;t.beginPath(),t.arc(n,i,h,0,v,!0),t.fill(),t.stroke()})}),{pointList:g,chartY:y,tableHeight:u}})}}return function(s){function l(e,n){t(this,l);var o,a,r=i(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));return r.ctx=null,r.options=null,r.data=null,r.scaleList=null,r.pointAllList=null,r.eventList=[],r.config=n,r.canvas=(a=null,(a="string"==typeof(o=e)?document.getElementById(o):o)&&a.getContext?a:(logs("error","Elements do not exist or browsers do not support!"),!1)),r.initCanvas(),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(l,n),e(l,[{key:"initCanvas",value:function(){var t=this.config,e=t.width,i=t.height;this.canvas.setAttribute("width",e),this.canvas.setAttribute("height",i),this.ctx=this.canvas.getContext("2d")}},{key:"setOptions",value:function(t){var e,i,n,a,r,s,l,c,f,u,h,v,p,d,y,m,g,x,b,k,S,L,w=t.scale,E=void 0===w?{}:w,T=t.chart,P=void 0===T?{}:T,A={};return A.scale=(i=(e=E).title,n=void 0===i?"杆号":i,a=e.keyName,r=void 0===a?"pole.poleName":a,s=e.height,l=void 0===s?30:s,c=e.lineWidth,f=void 0===c?1:c,u=e.strokeStyle,h=void 0===u?"#000":u,v=e.fillStyle,{title:n,keyName:r,height:l,lineWidth:f,strokeStyle:h,fillStyle:void 0===v?"#000":v}),A.chart=(d=(p=P).offsetLeft,y=void 0===d?100:d,m=p.tables,g=void 0===m?[]:m,x=p.tablesHeight,b=void 0===x?0:x,k=p.gridSpacingY,S=void 0===k?20:k,(L={}).offsetLeft=y,L.tablesHeight=b,L.gridSpacingY=S,L.tables=g.map(function(t){var e=t.title,i=void 0===e?"表名":e,n=t.keyName,a=void 0===n?"":n,r=t.min,s=void 0===r?0:r,l=t.max,c=void 0===l?100:l,f=t.setPercentage,u=void 0===f?null:f,h=t.pointRadius,v=void 0===h?6:h,p=t.pointRadian,d=void 0===p?360*Math.PI/180:p,y=t.fillStyle,m=void 0===y?"#000":y,g=t.strokeStyle,x=void 0===g?"#000":g,b=t.lineWidth;return{title:i,keyName:a,lineWidth:void 0===b?1:b,min:s,max:c,pointRadius:v,pointRadian:d,setPercentage:u||o,fillStyle:m,strokeStyle:x}}),L),this.options=A}},{key:"draw",value:function(t,e){this.setOptions(t),this.data&&(this.clear(),this.removeEvents()),this.data=e,this.layout()}},{key:"layout",value:function(){var t,e,i,n,o,a,s,l,c,f,u,h,v=this.ctx,p=this.config,d=this.options,y=this.data,m=p.width,g=p.height,x=d.scale,b=d.chart,k=b.offsetLeft,S=b.tablesHeight,L=b.tables,w=b.gridSpacingY,E=x.height,T=g-E;v.fillStyle="#fff",v.fillRect(0,0,m,g),this.scaleList=(t=v,i=x,n=(e={x:k,y:g-E,w:m-k,h:E}).x,o=e.y,a=e.w,s=e.h,l=i.title,c=i.keyName,f=i.lineWidth,u=i.strokeStyle,h=i.fillStyle,t.lineWidth=f,t.strokeStyle=u,t.fillStyle=h,t.beginPath(),t.moveTo(n,o),t.lineTo(n+a,o),t.stroke(),function(e){var i=[],r=o+f,v=s-f,p=.3*v,d=.5*v,y=r+p+.2*v+d,m=e.length,g=a/(m+1),x=n+g;return t.lineWidth=f,t.strokeStyle=u,t.fillStyle=h,t.textAlign="left",t.font=d+"px Arial",t.fillText(l,n,y,g/1.5),t.beginPath(),e.forEach(function(e){var n,o=(n=e,c.split(".").forEach(function(t){n=n[t]}),n);t.moveTo(x,r),t.lineTo(x,r+p),t.textAlign="center",t.font=d+"px Arial",t.fillText(o,x,y,.8*g),i.push({name:o,span:g,offsetLeft:x}),x+=g}),t.stroke(),i})(y),this.pointAllList=r(v,{x:0,y:0,w:m-0,h:S||T},{offsetLeft:k,tables:L,scaleTop:T,gridSpacingY:w})(this.scaleList,y),this.watchEvents()}},{key:"clear",value:function(){var t=this.ctx,e=this.config,i=e.width,n=e.height;t.clearRect(0,0,i,n)}},{key:"generateEventListener",value:function(t,e,i,n,o,r,s,l){var c=this.ctx,f=this.options,u=this.pointAllList;function h(t){var h=!1,v=!1,p=!1;e&&(e(t),u.forEach(function(e,r){var s=e.pointList,l=e.chartY,u=e.tableHeight;s.forEach(function(e,d){var y=e.values,m=e.x,g=(e.name,e.span),x=(s.length+1)*g,b={x:s[0].x-g,y:l,w:x,h:u},k={x:m-g/2,y:l,w:g,h:u};a(c,t,"rect",b)&&0===d&&i&&(i(t,b,{tableIndex:r}),p=!0),a(c,t,"rect",k)&&n&&(n(t,k,{tableIndex:r,xIndex:d}),v=!0),y.forEach(function(e,i){var n=e.y,s=f.chart.tables[r],l={x:m,y:n,radius:s.pointRadius,radian:s.pointRadian},u={tableIndex:r,xIndex:d,valueIndex:i};a(c,t,"point",l)&&o&&(o(t,l,u),h=!0)})})}),!p&&r&&r(t),!v&&s&&s(t),!h&&l&&l(t))}return this.eventList.push({eventName:t,eventListener:h}),this.canvas.addEventListener(t,h),h}},{key:"watchEvents",value:function(){var t=this,e=!1,i=!1,n=!1;this.generateEventListener("mouseenter",function(e){t.emit("mouseenter",e)}),this.generateEventListener("mousemove",function(e){t.emit("mousemove",e)},function(i,n,o){e?t.emit("tableMousemove",i,n,o):(t.emit("tableMouseenter",i,n,o),e=!0)},function(e,n,o){i?t.emit("axisXMousemove",e,n,o):(t.emit("axisXMouseenter",e,n,o),i=!0)},function(e,i,o){n?t.emit("pointMousemove",e,i,o):(t.emit("pointMouseenter",e,i,o),n=!0)},function(i,n){e&&(e=!1,t.emit("tableMouseleave"))},function(e,n){i&&(i=!1,t.emit("axisXMouseleave"))},function(e,i){n&&(n=!1,t.emit("pointMouseleave"))}),this.generateEventListener("mouseleave",function(o){t.emit("mouseleave",o),n=!1,i=!1,e=!1}),this.generateEventListener("click",function(e){t.emit("click",e)},function(e,i,n){t.emit("tableClick",e,i,n)},function(e,i,n){t.emit("axisXClick",e,i,n)},function(e,i,n){t.emit("pointClick",e,i,n)})}},{key:"removeEvents",value:function(){var t=this.canvas;this.eventList.forEach(function(e){var i=e.eventName,n=e.eventListener;t.removeEventListener(i,n)}),this.eventList=[]}}]),l}()});
